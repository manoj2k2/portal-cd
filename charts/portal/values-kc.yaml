###############################################################
# Copyright (c) 2021, 2023 Contributors to the Eclipse Foundation
#
# See the NOTICE file(s) distributed with this work for additional
# information regarding copyright ownership.
#
# This program and the accompanying materials are made available under the
# terms of the Apache License, Version 2.0 which is available at
# https://www.apache.org/licenses/LICENSE-2.0.
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
# SPDX-License-Identifier: Apache-2.0
###############################################################

name: "portal"

# -- Provide portal base address.
portalAddress: "https://portal.example.org"

# -- Provide portal-backend base address.
portalBackendAddress: "https://portal-backend.example.org"

# -- Provide centralidp base address (CX IAM), without trailing '/auth'.
centralidpAddress: "https://centralidp.example.org"

# -- Provide sharedidp address (CX IAM), without trailing '/auth'.
sharedidpAddress: "https://sharedidp.example.org"

# -- Provide semantics base address.
semanticsAddress: "https://semantics.example.org"

# -- Provide bpdm partners pool base address.
bpdmPartnersPoolAddress: "https://business-partners.example.org"

# -- Provide bpdm portal gate base address.
bpdmPortalGateAddress: "https://business-partners.example.org"

# -- Provide custodian base address.
custodianAddress: "https://managed-identity-wallets.example.org"

# -- Provide sdfactory base address.
sdfactoryAddress: "https://sdfactory.example.org"

# -- Provide clearinghouse base address.
clearinghouseAddress: "https://validation.example.org"
# -- Provide clearinghouse token address.
clearinghouseTokenAddress: "https://keycloak.example.org/realms/example/protocol/openid-connect/token"

frontend:
  ingress:
  # -- Portal frontend ingress parameters,
    # enable ingress record generation for portal frontend.
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: "/$1"
      nginx.ingress.kubernetes.io/use-regex: "true"
      nginx.ingress.kubernetes.io/enable-cors: "true"
      # -- Provide CORS allowed origin.
      nginx.ingress.kubernetes.io/cors-allow-origin: "https://*.example.org"
    tls:
      # -- Provide tls secret.
      - secretName: "tls-secert"
        # -- Provide host for tls secret.
        hosts:
          - "portal.example.org"
    hosts:
      # -- Provide default path for the ingress record.
      - host: "portal.example.org"
        paths:
          - path: "/(.*)"
            pathType: "Prefix"
            backend:
              service: "portal"
              port: 8080
          - path: "/registration/(.*)"
            pathType: "Prefix"
            backend:
              service: "registration"
              port: 8080
          - path: "/((assets|documentation)/.*)"
            pathType: "Prefix"
            backend:
              service: "assets"
              port: 8080
  portal:
    name: "portal"
    image:
      name: "tractusx/portal-frontend"
      portaltag: v1.7.0-RC2
    # -- We recommend not to specify default resources and to leave this as a conscious choice for the user.
    # If you do want to specify resources, uncomment the following lines,
    # adjust them as necessary, and remove the curly braces after 'resources:'.
    resources: {}
      # limits:
      #   cpu: 100m
      #   memory: 128Mi
      # requests:
      #   cpu: 100m
      #   memory: 128Mi
  centralidpAuthPath: "/auth"
  bpdmPartnersPoolApiPath: "/pool/api"


portContainer: 8080

portService: 8080

replicaCount: 1

# -- Node labels for pod assignment
nodeSelector: {}

# -- Tolerations for pod assignment
tolerations: []

affinity:
# -- Following Catena-X Helm Best Practices,
# [reference](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity).
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: DoesNotExist
          topologyKey: kubernetes.io/hostname

updateStrategy:
# -- Update strategy type,
# rolling update configuration parameters,
# [reference](https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#update-strategies).
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# -- Following Catena-X Helm Best Practices,
# [reference](https://github.com/helm/charts/blob/master/stable/nginx-ingress/values.yaml#L210).
startupProbe:
  failureThreshold: 30
  initialDelaySeconds: 10
  periodSeconds: 10
  successThreshold: 1
  timeoutSeconds: 1
livenessProbe:
  failureThreshold: 3
  initialDelaySeconds: 10
  periodSeconds: 10
  successThreshold: 1
  timeoutSeconds: 10
readinessProbe:
  failureThreshold: 3
  initialDelaySeconds: 10
  periodSeconds: 10
  successThreshold: 1
  timeoutSeconds: 1
